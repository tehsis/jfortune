!function(n){n.fn.fortune=function(t){var r=this,s=t.prices?t.prices:t,o=t.duration||1e3,e=t.separation||2,i=Array.isArray(s)?s.length:s,a=360/i,u=!1,m=t.min_spins||10,f=t.max_spins||15,c=t.onSpinBounce||function(){},l=!0
void 0!==t.clockWise&&(l=t.clockWise),r.spin=function(t,p){"undefined"!=typeof p&&null!==p||(p=-1)
var d=1
l||(d=-1),t="number"==typeof t?t:Math.floor(Math.random()*i)
var v=n.Deferred(),M=Math.floor(a*(t-.5)+h(e,a-e))
"number"!=typeof t&&void 0!==s[t].length&&(sub_amount=s[t].length,p=Math.floor(Math.random()*sub_amount),M=Math.floor(a*(t-.5)+a/sub_amount*p+h(e,a/sub_amount-e)))
var g=h(m,f),k=d*(360*g+d*M),w=0,y=!1
u=!0,r.css({transform:"rotate("+k+"deg)","-webkit-transform":"rotate("+k+"deg)",transition:"transform "+o+"ms cubic-bezier(.17,.67,.12,.99)","-webkit-transition":"-webkit-transform "+o+"ms cubic-bezier(.17,.67,.12,.99)"}).siblings(".spin").removeClass("bounce")
var _=function(){var n,t=Math.floor(b(r)),s=Math.floor((t+.5*a)%a),o=a/5,e=a/10
w=Math.floor(w>t?w-360*d:w),n=t-w,o>s&&e>n||3*o>s&&n>=e?y||(r.siblings(".spin").addClass("bounce"),c(r.siblings(".spin")),y=!0):(r.siblings(".spin").removeClass("bounce"),y=!1),u&&(w=t,requestAnimationFrame(_))},A=requestAnimationFrame(_)
return setTimeout(function(){r.css({transform:"rotate("+M+"deg)","-webkit-transform":"rotate("+M+"deg)",transition:"","-webkit-transition":""}).siblings(".spin").removeClass("bounce"),cancelAnimationFrame(A),result=s[t]||t,-1!=p&&(result=s[t][p]),v.resolve(result),u=!1},o),v.promise()}
var b=function(n){var t=0,r=n.css("-webkit-transform")||n.css("-moz-transform")||n.css("-ms-transform")||n.css("-o-transform")||n.css("transform")
if("none"!==r){var t,s=r.split("(")[1].split(")")[0].split(","),o=s[0],e=s[1],i=Math.atan2(e,o)
0>i&&(i+=2*Math.PI),t=Math.round(i*(180/Math.PI))}return t},h=function(n,t){return Math.floor(Math.random()*(t-n+1))+n}
return r.getCurrentPosition=function(){return b(r)},r}}(jQuery)
